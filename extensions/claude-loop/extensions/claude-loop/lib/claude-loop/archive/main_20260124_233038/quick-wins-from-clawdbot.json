{
  "project": "quick-wins-from-clawdbot",
  "branchName": "feature/quick-wins-v1-5-0",
  "description": "Implement Priority 1 Quick Wins from clawdbot comparison analysis: Tool Result Sanitization, Model Failover, Auto-Compaction with Memory Flush, and Basic Hook System. These improvements add resilience, context management, and extensibility to claude-loop.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Tool Result Sanitization",
      "description": "As a developer, I want tool outputs to be automatically truncated to prevent context overflow so that large file reads or git diffs don't exhaust the token budget",
      "acceptanceCriteria": [
        "Create lib/tool-sanitizer.py with sanitize_tool_result() function",
        "Function truncates text outputs to 8000 characters (UTF-16 safe)",
        "Add truncation marker: '[... truncated N chars ...]'",
        "Preserve first 7500 chars + last 500 chars for context",
        "Handle binary data gracefully (show size only)",
        "Integrate with existing tool execution in lib/worker.sh",
        "Add unit tests with 80%+ coverage",
        "Document in docs/features/tool-sanitization.md"
      ],
      "priority": 1,
      "passes": false,
      "notes": "",
      "fileScope": [
        "lib/tool-sanitizer.py",
        "lib/worker.sh",
        "tests/test_tool_sanitizer.py",
        "docs/features/tool-sanitization.md"
      ],
      "estimatedComplexity": "simple",
      "suggestedModel": "haiku"
    },
    {
      "id": "US-002",
      "title": "Model Failover and API Key Rotation",
      "description": "As an operator, I want claude-loop to automatically retry with different models and API keys on failures so that rate limits and provider outages don't halt execution",
      "acceptanceCriteria": [
        "Create lib/model-failover.py with provider rotation logic",
        "Support fallback chain: anthropic → openai → google → deepseek",
        "Implement API key rotation for rate limit errors (429)",
        "Add exponential backoff (1s, 2s, 4s) with max 3 retries per provider",
        "Detect error types: rate_limit, timeout, authentication, server_error",
        "Log failover attempts with provider and reason",
        "Integrate with existing API client in lib/api-client.sh",
        "Add configuration in config.yaml for failover providers",
        "Add unit tests with mock API failures",
        "Document in docs/features/model-failover.md"
      ],
      "priority": 2,
      "passes": false,
      "notes": "",
      "fileScope": [
        "lib/model-failover.py",
        "lib/api-client.sh",
        "config.yaml",
        "tests/test_model_failover.py",
        "docs/features/model-failover.md"
      ],
      "estimatedComplexity": "medium",
      "suggestedModel": "sonnet"
    },
    {
      "id": "US-003",
      "title": "Auto-Compaction with Memory Flush",
      "description": "As a user, I want important learnings to be preserved automatically when approaching context limits so that long-running tasks don't lose valuable insights",
      "acceptanceCriteria": [
        "Create lib/auto-compaction.py with memory flush logic",
        "Detect when session token count exceeds 90% of context limit",
        "Trigger silent agent turn with prompt: 'INTERNAL: Approaching context limit. Write important notes to MEMORY.md. Reply NO_REPLY if nothing to say.'",
        "Parse NO_REPLY response and skip user notification",
        "Write memory to workspace/MEMORY.md (append mode)",
        "Run compaction after memory flush completes",
        "Add session token counting utility",
        "Integrate with session-state.py checkpoint system",
        "Add unit tests for threshold detection and memory writing",
        "Document in docs/features/auto-compaction.md"
      ],
      "priority": 3,
      "passes": false,
      "notes": "",
      "fileScope": [
        "lib/auto-compaction.py",
        "lib/session-state.py",
        "workspace/MEMORY.md",
        "tests/test_auto_compaction.py",
        "docs/features/auto-compaction.md"
      ],
      "estimatedComplexity": "medium",
      "suggestedModel": "sonnet"
    },
    {
      "id": "US-004",
      "title": "Basic Hook System",
      "description": "As a plugin developer, I want to register lifecycle hooks so that I can customize behavior without modifying core code",
      "acceptanceCriteria": [
        "Create lib/hooks.py with HookRegistry class",
        "Support hook registration with priorities (higher = runs first)",
        "Implement core lifecycle hooks: before_story_start, after_story_complete, before_tool_call, after_tool_call, on_error, on_session_end",
        "Add hook runner that executes hooks sorted by priority",
        "Implement error isolation (failed hook doesn't crash others)",
        "Support async hook functions",
        "Add context object passed to all hooks (story_id, prd_data, session_id, etc.)",
        "Allow hooks to modify context (return updated context)",
        "Create example hooks in hooks/examples/",
        "Integrate hook execution into lib/worker.sh at appropriate lifecycle points",
        "Add unit tests for hook registration, execution order, and error handling",
        "Document hook system in docs/plugins/hooks-guide.md with examples"
      ],
      "priority": 4,
      "passes": false,
      "notes": "",
      "fileScope": [
        "lib/hooks.py",
        "lib/worker.sh",
        "hooks/examples/notify-slack.py",
        "hooks/examples/auto-format.py",
        "tests/test_hooks.py",
        "docs/plugins/hooks-guide.md"
      ],
      "estimatedComplexity": "medium",
      "suggestedModel": "sonnet"
    },
    {
      "id": "US-005",
      "title": "Integration Testing and Documentation",
      "description": "As a maintainer, I want comprehensive integration tests and documentation so that Quick Wins work reliably in production",
      "acceptanceCriteria": [
        "Create tests/integration/test_quick_wins.py with end-to-end tests",
        "Test tool sanitization with large file reads (>10KB)",
        "Test model failover with mock provider failures",
        "Test auto-compaction with session approaching limit",
        "Test hook system with multiple registered hooks",
        "All integration tests pass with 100% success rate",
        "Update RELEASE_NOTES.md with Quick Wins features",
        "Update UPGRADE_GUIDE.md with migration instructions",
        "Create QUICK_WINS_SUMMARY.md with benefits and usage examples",
        "Add metrics: expected token savings, uptime improvement, extensibility gain"
      ],
      "priority": 5,
      "passes": false,
      "notes": "",
      "fileScope": [
        "tests/integration/test_quick_wins.py",
        "RELEASE_NOTES.md",
        "UPGRADE_GUIDE.md",
        "QUICK_WINS_SUMMARY.md"
      ],
      "estimatedComplexity": "simple",
      "suggestedModel": "haiku"
    }
  ]
}
